!function(){return function e(t,r,s){function o(a,i){if(!r[a]){if(!t[a]){var p="function"==typeof require&&require;if(!i&&p)return p(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[a]={exports:{}};t[a][0].call(d.exports,function(e){return o(t[a][1][e]||e)},d,d.exports,e,t,r,s)}return r[a].exports}for(var n="function"==typeof require&&require,a=0;a<s.length;a++)o(s[a]);return o}}()({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e};function o(e){return n(e.split(","))}function n(e){if(2===e.length)return{lat:parseFloat(e[0]),lng:parseFloat(e[1])};throw"Could not transform array to coords, because wrong length..."}function a(e){return[e.lat,e.lng]}function i(e){return`${e.lat},${e.lng}`}r.stringToCoords=o,r.arrayToCoords=n,r.coordsToArray=a,r.coordsToString=i,r.parseToCoords=function(e){if("string"==typeof e)return o(e);if("object"==typeof e){if(Array.isArray(e))return n(e);{const t=s({},e);return t.lat=parseFloat(t.lat),t.lng=parseFloat(t.lng),t}}},r.getCoordsAs=function(e,t){if(t===String)return i(e);if(t===Array)return a(e);if(t===Object)return e;throw`${t} is not supported as coordinate storage`}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){e.prototype.$mapsection=new e({data:()=>({fields:[],maps:[],updatingMaps:!1,updatingFields:!1}),methods:{getAcceptedType(t){let r=e.options.components["k-"+t.type+"-field"];return r?r.options.props.value.type:(console.warn('Mapsection could not update form: Unknown field type "'+this.fields[k].type+'"'),null)},updateFields(e,t,r){this.updatingMaps||(this.updatingFields=!0,this.fields.forEach(o=>{if(t in o.fields){let n=this.getAcceptedType(o.fields[t]);if(!n)return;switch(e){case"center":o.values[t]=(0,s.getCoordsAs)(r,n);break;case"markers":let a=o.fields[t].fields;a&&a.coords?o.values[t]=r.map(e=>{if((e=Object.assign({},e)).coords){let t=this.getAcceptedType(a.coords);if(!t)return;e.coords=(0,s.getCoordsAs)(e.coords,t)}return e}):o.values[t]=r;break;default:o.values[t]=r}o.input(o.values)}}),this.$nextTick(()=>this.updatingFields=!1))},updateMaps(e){this.updatingFields||(this.updatingMaps=!0,this.maps.forEach(t=>{for(let r in e){let s=e[r];t.setValue(r,s)}}),this.$nextTick(()=>this.updatingMaps=!1))},registerMap(e){this.maps.push(e)},unregisterMap(e){const t=this.fields.indexOf(e);-1!==t&&this.maps.splice(t,1)},registerFields(e){this.fields.push(e)},unregisterFields(e){const t=this.fields.indexOf(e);-1!==t&&this.fields.splice(t,1)}}});const t=e.options.components["k-fields-section"];e.component("k-fields-section",{extends:t,created(){this.$mapsection.registerFields(this)},destroyed(){this.$mapsection.unregisterFields(this)},methods:{input(e){this.values=e,t.options.methods.input.call(this,e),this.$mapsection.updateMaps(e)}},watch:{values(e){this.$mapsection.updateMaps(e)}}})};var s=e(1)},{1:1}],3:[function(e,t,r){!function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},o=e(1),n=e(5),a=(t=n)&&t.__esModule?t:{default:t};r.default={components:{mapComponent:window.MapSectionComponent||a.default},props:{parent:String,name:String,error:String},data:()=>({config:null,storage:{},height:"medium",center:{lat:8,lng:32},zoom:void 0,markers:[]}),created(){this.$api.get(this.parent+"/sections/"+this.name).then(e=>{this.config=e.config,this.height=e.height,this.storage=e.storage}),this.$mapsection.registerMap(this)},destroyed(){this.$mapsection.unregisterMap(this)},computed:{remheight(){switch(this.height){case"small":return"16rem";case"medium":return"24rem";case"large":return"32rem";case"huge":return"40rem";default:return this.height}}},methods:{setValue(e,t){if((!Array.isArray(t)||0!=t.length)&&t)try{for(let r in this.storage)if(this.storage[r]===e)switch(r){case"center":this.center=(0,o.parseToCoords)(t);break;case"zoom":let e=parseFloat(t);isNaN(e)?console.warn("could not adapt field to zoom datapoint, not a number: ",t):this.zoom=e;break;case"markers":if(!Array.isArray(t)){console.warn("could not adapt field to markers datapoint, not an array: ",t);break}this.markers=t.map(e=>s({},e,{coords:(0,o.parseToCoords)(e.coords)}));break;default:this[r]=t}}catch(e){console.warn(e)}},updateCenter(e){this.storage.center&&this.$mapsection.updateFields("center",this.storage.center,e)},updateZoom(e){this.storage.zoom&&this.$mapsection.updateFields("zoom",this.storage.zoom,e)},updateMarkers(e){this.storage.markers&&this.$mapsection.updateFields("markers",this.storage.markers,e)}}}}(),t.exports.__esModule&&(t.exports=t.exports.default);var s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.config?r("map-component",{style:{height:e.remheight},attrs:{center:e.center,zoom:e.zoom,markers:e.markers,config:e.config},on:{"update:center":e.updateCenter,"update:zoom":e.updateZoom,"update:markers":e.updateMarkers}}):e._e()},s.staticRenderFns=[]},{1:1,5:5}],4:[function(e,t,r){"use strict";var s=n(e(2)),o=n(e(3));function n(e){return e&&e.__esModule?e:{default:e}}panel.plugin("rasteiner/kn-map-section",{use:[s.default],sections:{map:o.default}})},{2:2,3:3}],5:[function(e,t,r){!function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},o=e(6),n=(t=o)&&t.__esModule?t:{default:t};r.default={props:{center:Object,zoom:{type:Number,default:2},markers:Array,config:Object},data:()=>({map:null,mapListeners:[],localMarkers:[]}),async mounted(){await(0,n.default)(this.config.key),this.map=new google.maps.Map(this.$refs.container,{zoom:this.zoom,center:this.center}),this.mapListeners.push(this.map.addListener("center_changed",this.onCenterChanged)),this.mapListeners.push(this.map.addListener("zoom_changed",this.onZoomChanged)),this.renderMarkers(this.markers)},destroyed(){this.mapListeners.forEach(function(e){e.remove()}),this.mapListeners=[]},watch:{zoom(e){this.map&&this.map.setZoom(parseFloat(e))},center(e){this.map&&this.map.setCenter(e)},markers:{deep:!0,handler(e){this.map&&this.renderMarkers(e)}}},methods:{renderMarkers(e){this.localMarkers.forEach(e=>e.gm.setMap(null)),this.localMarkers=e.map(e=>{const t=new google.maps.Marker({position:e.coords,map:this.map,title:e.title,draggable:!0});return t.addListener("position_changed",this.onMarkersChanged),{gm:t,m:e}})},onCenterChanged(){this.$emit("update:center",{lat:this.map.getCenter().lat(),lng:this.map.getCenter().lng()})},onZoomChanged(){this.$emit("update:zoom",this.map.getZoom())},onMarkersChanged(){this.$emit("update:markers",this.localMarkers.map(e=>s({},e.m,{coords:{lat:e.gm.getPosition().lat(),lng:e.gm.getPosition().lng()}})))}}}}(),t.exports.__esModule&&(t.exports=t.exports.default);var s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var e=this.$createElement;return(this._self._c||e)("div",{ref:"container",staticClass:"mapscontainer"})},s.staticRenderFns=[]},{6:6}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){const t={};if(o)return new Promise(e=>e());if(!s){s=!0;const t=document.createElement("script"),r="rasteinermapssectionloader",a={key:e,callback:r},i="https://maps.googleapis.com/maps/api/js?"+Object.keys(a).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(a[e])).join("&");t.setAttribute("src",i),t.setAttribute("async",""),t.setAttribute("defer",""),document.head.appendChild(t),window[r]=(()=>{o=!0;for(let e of n)e.resolve()}),t.addEventListener("error",e=>{for(let t of n)t.reject(e)})}return n.push(t),new Promise((e,r)=>{t.resolve=e,t.reject=r})};let s=!1,o=!1;const n=[]},{}]},{},[4]);
